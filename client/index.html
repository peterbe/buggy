<!doctype html>
<html lang="en" ng-app="buggyApp">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buggy</title>

<link rel="stylesheet" href="static/css/pure-min.css">
<link rel="stylesheet" href="static/css/email.css">
<link rel="stylesheet" href="static/css/extra.css">

<!---<script src="http://use.typekit.net/gis6vng.js"></script>
<script>
    try { Typekit.load(); } catch (e) {}
</script>-->

</head>
<body>






<div class="pure-g-r content" id="layout" ng-controller="BugsController">
    <div class="pure-u" id="nav">
        <a href="#" class="nav-menu-button">Menu</a>

        <div class="nav-inner">
            <!--
            <button class="pure-button primary-button">Compose</button>-->

            <div class="pure-menu pure-menu-open">
                <ul>
                    <!--
                    <li><a href="#">Inbox <span class="email-count">(2)</span></a></li>
                    <li><a href="#">Important</a></li>
                    <li><a href="#">Sent</a></li>
                    <li><a href="#">Drafts</a></li>
                    <li><a href="#">Trash</a></li>
                    -->
                    <li class="pure-menu-heading">Statuses</li>
                    <li class="label"
                        ><a href="#" ng-class="{active: !selected_statuses.length}"
                          ng-click="filterByStatus('ALL')"
                          ><span class="status status-ALL"></span>ALL ({{ countByStatus('ALL') }})</a></li>
                    <li ng-repeat="status in all_possible_statuses"
                        class="label"
                        ><a href="#" ng-click="filterByStatus(status)"
                          ng-class="{active: isSelectedStatus(status)}"
                          ><span class="status status-{{ status }}"></span>{{ status }} ({{ countByStatus(status) }})</a></li>
                    <!--
                    <li><a href="#"><span class="email-label-work"></span>Work</a></li>
                    <li><a href="#"><span class="email-label-travel"></span>Travel</a></li>
                    -->
                    <li class="pure-menu-heading">Options</li>
                    <li><a href="#/config" ng-click="toggleConfig()">Config</a></li>

                </ul>
            </div>

        </div>
    </div>

    <div class="pure-u-1" id="list">
        <div id="list-options">
          <p>
                      <a href="#" ng-click="refreshBugs()"
                       title="Can't wait to see if it's updated remotely?"
                       ><img src="static/images/refresh.png" alt="Refresh"> Refresh List</a>
          </p>
        </div>
        <!-- consider `email-item-selected` -->
        <!-- consider `email-item-unread` -->
        <div id="list-items">
        <div class="email-item pure-g" ng-repeat="bug in bugs | filter:isFilteredStatus | orderBy:'last_change_time':true track by bug.id"
             ng-class="{'email-item-unread': bug.unread, 'email-item-active': isSelectedBug(bug)}" ng-click="selectBug(bug)">
            <div class="pure-u">
                <img class="email-avatar" alt="Avatar" height="32" width="32" ng-src="{{ avatarURL(bug.email) }}">
                <br><br>
                <abbr style="margin-left:10px" class="badge badge-small" ng-if="hasAdditionalComments(bug)" title="Number of comments">{{ countAdditionalComments(bug) }}</abbr>
            </div>

            <div class="pure-u-5-6">
                <h5 class="email-name">{{ bug.product }} :: {{ bug.component }}</h5>
                <h4 class="email-subject"><a href="{{ makeBugzillaLink(bug.id) }}" target="_blank">{{ bug.id }}</a> {{ bug.summary }}</h4>
                <!--<p><a href="{{ makeBugzillaLink(bug.id) }}" target="_blank">{{ bug.id }}</a></p>-->
                <p class="email-desc">

                    <!--{{ bug.last_change_time }}<br>-->
                    {{ bug.extract }}
                  <br>
                  <span class="badge badge-small badge-{{ bug.status }}" ng-if="bug.status">{{ bug.status }}</span>
                  <span class="badge badge-small" ng-if="bug.resolution">{{ bug.resolution }}</span>
                </p>
            </div>
        </div>
        </div>

    </div>

    <div class="pure-u-1" id="main">

        <div ng-if="in_config">
            <div class="email-content-header pure-g">
                <div class="pure-u-2-3">
                    <h1 class="email-content-title">Configuration Options</h1>
                </div>
                <div class="pure-u-1-3">
                    <p style="text-align: right"><a href="#" ng-click="toggleConfig()">Close</a></p>
                </div>
            </div>

            <div class="email-content-body">
              <h2>In Memory</h2>
              <dl>
                <dt># Bugs in scope</dt>
                <dd>{{ config_stats.total_bugs }}</dd>
                <dt># Comments in all bugs</dt>
                <dd>{{ config_stats.total_comments }}</dd>
                <dt>Data downloaded</dt>
                <dd>{{ config_stats.data_downloaded_human }}</dd>
              </dl>
            </div>

            <div class="email-content-body">
              <h2>Debug Tools</h2>
              <form ng-submit="clearLocalStorage()">
                <button class="pure-button pure-button-primary">Clear Local Storage</button>
              </form>
            </div>

        </div>

        <div class="email-content" ng-if="bug.empty && !in_config">
            <div class="email-content-header pure-g">
                <div class="pure-u-1-2">
                    <h1 class="email-content-title">Nothing selected</h1>
                </div>
            </div>

            <div class="email-content-body">
             Select a bug in the left-hand column
            </div>
        </div><!-- /empty -->

        <div class="email-content" ng-if="!bug.empty && !in_config">
            <div class="email-content-header pure-g">
                <div class="pure-u-2-3">
                    <h2 class="email-content-title">{{ bug.summary }}</h2>
                    <p class="external-url">
                      <a href="https://bugzilla.mozilla.org/show_bug.cgi?id={{ bug.id }}"
                         target="_blank">
                        {{ makeBugzillaLink(bug.id) }}
                      </a>
                    </p>
                    <p class="email-content-subtitle">
                        By
                        <b ng-if="!isEmail(bug.creator.name)">{{ bug.creator.name }}</b>

                        <b ng-if="isEmail(bug.creator.name)">
                        <img class="email-avatar" alt="Avatar" height="32" width="32" ng-src="{{ avatarURL(bug.creator.name) }}">
                        {{ bug.creator.name }}</b>
                        at <span>{{ bug.creation_time }}</span>
                    </p>
                </div>

                <div class="pure-u-1-3 email-content-controls">
                    <span class="badge badge-{{ bug.status }}" ng-if="bug.status">{{ bug.status }}</span>
                    <span class="badge badge" ng-if="bug.resolution">{{ bug.resolution }}</span>

                    <p>
                      <a href="#" ng-click="refreshBug(bug)"
                       title="Can't wait to see if it's updated remotely?"
                       ><img src="static/images/refresh.png" alt="Refresh"></a>
                    </p>
                    <!--<button class="pure-button secondary-button">Reply</button>
                    <button class="pure-button secondary-button">Forward</button>
                    <button class="pure-button secondary-button">Move to</button>-->
                </div>
            </div>


            <div class="email-content-body" ng-repeat="comment in bug.comments">
               <div class="pure-u" ng-if="isEmail(comment.creator.name)">
                        <img class="email-avatar" alt="Avatar" height="32" width="32" ng-src="{{ avatarURL(comment.creator.name) }}"
                             >

               </div>
               <div class="pure-u-3-4">
               <p class="email-content-subtitle">
                        By <b>{{ comment.creator.name }}</b> at
                        <a href="{{ makeBugzillaLink(bug.id) }}#c{{ $index }}"><span>{{ comment.creation_time }}</span></a>
                        <br>
                        <span>{{ displayTimeAgo(comment.creation_time) }}</span>
               </p>
               </div>
             <pre ng-bind-html="comment.text | linky:'_blank'"></pre>

            </div>

        </div><!-- /!empty -->
    </div>

    <div class="loading pure-u ng-hide" ng-show="loaders.fetching_bugs">
      <p class="blinking">Fetching bugs</p>
    </div>

    <div class="loading pure-u ng-hide" ng-show="loaders.fetching_comments">
      <p class="blinking">Fetching comments</p>
    </div>

    <div class="loading pure-u ng-hide" ng-show="loaders.refreshing_bug">
      <p class="blinking">Refreshing bug and comments</p>
    </div>

    <div class="loading pure-u ng-hide" ng-show="loaders.refreshing_bugs">
      <p class="blinking">Refreshing bug list</p>
    </div>

    <div class="errornotice pure-u ng-hide" ng-show="errors.update_comments">
      <p>Remote trouble. Unable to fetch the bug comments.</p>
    </div>


</div>



<script src="static/js/vendor/angular.min.js"></script>
<script src="static/js/vendor/angular-sanitize.min.js"></script>
<script src="static/js/vendor/localForage.js"></script>
<script src="static/js/vendor/underscore-min.js"></script>
<script src="static/js/vendor/moment.min.js"></script>
<script src="static/js/vendor/filesize.min.js"></script>
<script src="static/js/utils.js"></script>
<script src="static/js/buggy.js"></script>
<!-- things that aren't immediately needed -->
<script async src="static/js/vendor/filesize.min.js"></script>

</body>
</html>
